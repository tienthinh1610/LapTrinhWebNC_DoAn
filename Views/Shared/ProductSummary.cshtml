@model Product

@{
    var mainImageUrl = Model.Images?.FirstOrDefault(img => img.IsMainImage)?.ImageUrl 
                     ?? "/images/placeholder-664.webp"; 
    // Tạo URL đến trang chi tiết sản phẩm
    // Url.Action() sẽ tạo ra "/Home/Details/{ProductID}"
    var detailsUrl = Url.Action("Details", "Home", new { id = Model.ProductID });
}

<div class="card h-100 shadow-sm border-0 transition-3s product-card"> 
    
    <a asp-action="Details" asp-controller="Home" asp-route-id="@Model.ProductID" class="text-decoration-none d-block">
        <img src="@mainImageUrl" class="card-img-top img-fluid" alt="@Model.Name" 
             style="height: 500px; object-fit: contain; padding: 15px;" />
    </a>
    
    <div class="card-body d-flex flex-column p-3">
        <h5 class="card-title mb-2 text-truncate">
            <a asp-action="Details" asp-controller="Home" asp-route-id="@Model.ProductID" 
               class="text-decoration-none text-dark fw-bold">
                @Model.Name
            </a>
        </h5>
        
        <p class="card-text text-muted mb-3 line-clamp-2 flex-grow-1">
            @Model.Description
        </p>

        <div class="size-overlay">
            @if (Model.Variants != null && Model.Variants.Any())
            {
                <div class="mb-3">
                    <small class="text-muted">Size: </small>
                    @foreach (var size in Model.Variants.Select(v => v.Size).Distinct().OrderBy(s => s))
                    {
                        <span class="badge bg-dark text-white border me-1">@size</span>
                    }
                </div>
            }
        </div>
        
        <div class="d-flex justify-content-between align-items-center mt-auto">
            <h4 class="text-primary fw-bolder mb-0">
    @Model.Price.ToString("N0") VNĐ 
</h4>
            
            <form id="form_@Model.ProductID" asp-page="/Cart" method="post">
                <input type="hidden" asp-for="ProductID" />
                <input type="hidden" name="returnUrl" value="@ViewContext.HttpContext.Request.PathAndQuery()" />
                
                <button type="submit" class="btn btn-primary btn-sm">
                    <i class="fas fa-cart-plus me-1"></i> Mua
                </button>
            </form>
        </div>
    </div>
</div>

<style>
.line-clamp-2 {
    /* (CSS này giữ nguyên) */
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
}
.transition-3s:hover {
    /* (CSS này giữ nguyên) */
    transform: translateY(-5px); 
    box-shadow: 0 1rem 3rem rgba(0,0,0,.175)!important;
    transition: all 0.3s ease-in-out;
}

/* ---------------------------------------------------- */
/* CSS MỚI CHO HIỆU ỨNG HOVER SIZE            */
/* ---------------------------------------------------- */

.product-card .size-overlay {
    /* 1. Ẩn Size ban đầu */
    opacity: 0;
    height: 0;
    overflow: hidden;
    transition: all 0.3s ease-in-out; /* Thêm chuyển động mượt mà */
    margin-bottom: 0 !important;
    padding-bottom: 0 !important;
}

.product-card:hover .size-overlay {
    /* 2. Hiển thị Size khi hover */
    opacity: 1;
    height: auto;
    margin-bottom: 1rem !important; /* Đặt lại margin để không bị dính */
}

/* Tùy chỉnh màu Size khi hiển thị */
.size-overlay .badge {
    background-color: #343a40 !important; /* Màu nền tối */
    color: #fff !important; /* Chữ trắng */
}

</style>

@section Scripts {
    <script>
        document.querySelectorAll('.clickable-card').forEach(card => {
            card.addEventListener('click', function(event) {
                // Kiểm tra xem click có phải từ nút "Mua" hay một liên kết bên trong không
                // Nếu click vào nút "Mua" hoặc một liên kết bên trong, không chuyển hướng toàn bộ card
                if (event.target.closest('form') || event.target.closest('a')) {
                    return; 
                }
                
                // Lấy ProductID từ thuộc tính data-product-id
                const productId = this.dataset.productId;
                if (productId) {
                    // Xây dựng URL và chuyển hướng
                    window.location.href = `/Home/Details/${productId}`;
                }
            });
        });
    </script>
}